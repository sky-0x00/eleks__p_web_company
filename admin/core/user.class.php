<?php

////////////////////////////////////////////////////////////////////////////////
//
//	user.inc.php - класс User
//
// 	Версия: 2.0
//
////////////////////////////////////////////////////////////////////////////////
//
//	Разработчики: Быков Юрий.
//	Автор последнего изменения: Быков Юрий.
//
//	Дата последнего изменения: 29 March 2006 16:05:27
//
////////////////////////////////////////////////////////////////////////////////



////////////////////////////////////////////////////////////////////////////////
//
//	Класс для работы с данными пользователей.
//
////////////////////////////////////////////////////////////////////////////////
class User {
	
	////////////////////////////////////////////////////////////////////////////////
	//
	//	START 1. Свойства класса.
	//
	////////////////////////////////////////////////////////////////////////////////
	//	идентификатор пользователя
	var $user_id;
	//	имя пользователя
	var $name;
	//	date_created
	var $date_add;
	var $group_id;
	var $group_name;
	////////////////////////////////////////////////////////////////////////////////
	//
	//	END 1. Свойства класса.
	//
	////////////////////////////////////////////////////////////////////////////////
	
	//	Constructor
	function User ( $user_id ) {
		
		global $sess;
		
		$this->user_id = $user_id;
		$this->LoadFromDB ();
		
		return true;
		
	}
	
	////////////////////////////////////////////////////////////////////////////////
	//
	//	START 2. Методы класса.
	//
	////////////////////////////////////////////////////////////////////////////////
	function LoadFromDB () {
		
		global $cfg;
		
		$i = -1;
		
		if ( isset ( $this->database_class ) ) {
            
			$db = new $this->database_class;
            
        }
		$sql = sprintf ( "SELECT HIGH_PRIORITY a.name, a.date_add, b.group_id, c.name AS gname FROM %s a, %s b, %s c WHERE a.user_id='%s' AND a.user_id=b.user_id AND b.group_id=c.group_id", $cfg[DB][Table][users], $cfg[DB][Table][groups_users], $cfg[DB][Table][groups], $this->user_id );
		$db->query ( $sql );
		$db->next_record ();
		$this->name      = specialchars ( $db->f ( "name" ) );
		$this->date_add  = $db->f ( "date_add" );
		$this->group_id  = $db->f ( "group_id" );
		
		return true;
		
	}
	
	function ReloadData () {
		
		$this->LoadFromDB ();
		
	}
	
	function GetID () {
		
		return $this->user_id;
		
	}
	
	//	возвращает имя пользователя
	function GetName () {
		
		return $this->name;
		
	}
	function GetGroupId () {
		
		return $this->group_id;
		
	}
	function GetGroupName () {
		
		return $this->group_name;
		
	}
	////////////////////////////////////////////////////////////////////////////////
	//
	//	END 2. Методы класса.
	//
	////////////////////////////////////////////////////////////////////////////////
	
}
////////////////////////////////////////////////////////////////////////////////



////////////////////////////////////////////////////////////////////////////////
//	Вывод информации о подключенном файле.
if ( ERROR_PRINT_INCLUDE_FILENAME != 0 )
	echo "Class User (file " . basename ( __FILE__ ) . ")<br>";
////////////////////////////////////////////////////////////////////////////////

?>